<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de DUT/ATPV - 2M Motos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* Configuração A4 Otimizada */
        #pdf-template {
            width: 210mm;
            height: 297mm;
            padding: 15mm 20mm;
            background: white;
            margin: 0;
            color: #1a1a1a;
            line-height: 1.4;
            font-size: 11pt;
        }

        .hidden-container {
            position: absolute;
            top: -10000px;
            left: -10000px;
            width: 210mm;
        }

        .data-val {
            font-weight: 700;
            color: #000;
        }
    </style>
</head>

<body class="py-10 px-4">

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-2xl overflow-hidden border border-gray-100">
        <div class="bg-slate-900 p-6 flex justify-between items-center">
            <img src="https://i.ibb.co/DD98rjsH/logo1.png" alt="2M Motos" class="h-10">
            <h1 class="text-white font-bold text-lg tracking-wider">GERADOR DE DUT/ATPV</h1>
        </div>

        <form id="dutForm" class="p-8 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2 border-b pb-1">
                <h2 class="text-slate-800 font-bold text-xs uppercase">Comprador</h2>
            </div>
            <input type="text" id="nome" placeholder="Nome Completo/Razão Social" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500">
            <input type="text" id="cpf_cnpj" placeholder="CPF/CNPJ" maxlength="18" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500">
            <input type="hidden" id="tipo_pessoa" value="">

            <div class="md:col-span-2 border-b pb-1 mt-2">
                <h2 class="text-slate-800 font-bold text-xs uppercase">Veículo</h2>
            </div>
            <input type="text" id="modelo_moto" placeholder="Marca/Modelo" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500">
            <input type="text" id="ano_modelo" placeholder="Ano/Modelo" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500">
            <input type="text" id="placa" placeholder="Placa" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500 uppercase">
            <input type="text" id="renavam" placeholder="Renavam" required
                class="border-gray-300 border p-2 rounded outline-none focus:border-red-500">
            <input type="text" id="chassi" placeholder="Chassi" required
                class="md:col-span-2 border-gray-300 border p-2 rounded outline-none focus:border-red-500 uppercase">

            <div class="md:col-span-2 mt-6 flex flex-wrap gap-4">
                <button type="button" onclick="gerar('visualizar')"
                    class="flex-1 bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-700 transition">VISUALIZAR</button>
                <button type="button" onclick="gerar('salvar')"
                    class="flex-1 bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition">SALVAR
                    PDF</button>
                <button type="button"
                    onclick="document.getElementById('dutForm').reset(); document.getElementById('tipo_pessoa').value = '';"
                    class="px-8 bg-gray-400 text-white font-bold py-3 rounded-lg hover:bg-gray-500 transition">LIMPAR</button>
            </div>
        </form>
    </div>

    <div class="hidden-container">
        <div id="pdf-template">
            <div style="text-align: center; margin-bottom: 20px;">
                <img src="https://i.ibb.co/jPy9b9fZ/logo2.png" style="width: 180px;">
            </div>

            <h1
                style="text-align: center; font-weight: bold; font-size: 15pt; text-decoration: underline; margin-bottom: 30px;">
                Recibo de Entrega do DUT/ATPV</h1>

            <p style="text-align: justify; margin-bottom: 20px;">
                Eu/Nós, <span id="out_nome" class="data-val"></span>,
                <span id="out_documento_label"></span> n° <span id="out_cpf_cnpj" class="data-val"></span>,
                declaro(amos) ter recebido nesta data o documento único de transferência (DUT) ou a Autorização de
                Transferência de Propriedade do Veículo (ATPV),
                procuração e documento pessoal do outorgante e procurador, referente ao veículo abaixo descrito,
                adquirido da empresa <strong>2M Motos Ltda</strong>, inscrita no CNPJ n°
                <strong>35.432.104/0001-50</strong>,
                estabelecida na Rua J4 quadra 36 lote 15 Mansões Paraíso – Aparecida de Goiânia – Go – Cep: 74952-060:
            </p>

            <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                <h3 style="font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #eee; font-size: 11pt;">
                    Dados do Veículo:</h3>
                <p>Marca/Modelo: <span id="out_modelo" class="data-val"></span></p>
                <p>Ano/Modelo: <span id="out_ano" class="data-val"></span></p>
                <p>Placa: <span id="out_placa" class="data-val"></span></p>
                <p>Renavam: <span id="out_renavam" class="data-val"></span></p>
                <p>Chassi: <span id="out_chassi" class="data-val"></span></p>
            </div>

            <div style="text-align: justify; margin-bottom: 20px;">
                <p style="font-weight: bold; margin-bottom: 8px;">Declaro(amos), ainda, estar ciente de que a partir da
                    assinatura deste recibo:</p>
                <ul style="margin-left: 20px;">
                    <li>• O veículo acima descrito passa a ser de minha/nossa total responsabilidade;</li>
                    <li>• A empresa 2M Motos Ltda não possui qualquer vínculo ou responsabilidade futura;</li>
                    <li>• Comprometo-me/Comprometemo-nos a realizar a devida transferência junto ao Detran no prazo de
                        30 dias.</li>
                </ul>
            </div>

            <p style="text-align: center; font-weight: bold; margin-bottom: 30px; font-style: italic;">Por ser a
                expressão da verdade, firmo(amos) o presente recibo, dando plena e irrevogável quitação.</p>

            <p style="text-align: right; font-weight: bold; margin-bottom: 50px;">Aparecida de Goiânia, <span
                    id="out_data"></span></p>

            <div style="text-align: center; margin-top: 40px;">
                <div
                    style="display: inline-block; width: 250px; margin-bottom: 40px; border-top: 1px solid #000; padding-top: 5px; font-size: 10pt; font-weight: bold;">
                    <span id="out_assinatura_label">ASSINATURA DO COMPRADOR</span>
                </div>
                <br>
                <div
                    style="display: inline-block; width: 250px; border-top: 1px solid #000; padding-top: 5px; font-size: 10pt; font-weight: bold;">
                    2M MOTOS LTDA - REPRESENTANTE</div>
            </div>
        </div>
    </div>

    <script>
        // Máscara para CPF ou CNPJ
        document.getElementById('cpf_cnpj').addEventListener('input', e => {
            let v = e.target.value.replace(/\D/g, '');

            // Verifica se é CPF (11 dígitos) ou CNPJ (14 dígitos)
            if (v.length <= 11) {
                // Formata CPF: 000.000.000-00
                v = v.replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                document.getElementById('tipo_pessoa').value = 'cpf';
            } else {
                // Limita para 14 dígitos se for CNPJ
                v = v.slice(0, 14);
                // Formata CNPJ: 00.000.000/0000-00
                v = v.replace(/(\d{2})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1/$2')
                    .replace(/(\d{4})(\d{1,2})$/, '$1-$2');
                document.getElementById('tipo_pessoa').value = 'cnpj';
            }

            e.target.value = v;
        });

        // Validação de CPF/CNPJ
        function validarDocumento(documento) {
            const docLimpo = documento.replace(/\D/g, '');

            if (docLimpo.length === 11) {
                // Validação básica de CPF
                if (/^(\d)\1{10}$/.test(docLimpo)) return false;
                return true;
            } else if (docLimpo.length === 14) {
                // Validação básica de CNPJ
                if (/^(\d)\1{13}$/.test(docLimpo)) return false;
                return true;
            }
            return false;
        }

        async function gerar(acao) {
            const f = document.getElementById('dutForm');
            if (!f.checkValidity()) return alert("Preencha todos os campos.");

            const documento = document.getElementById('cpf_cnpj').value;
            const docLimpo = documento.replace(/\D/g, '');

            // Validação do documento
            if (docLimpo.length !== 11 && docLimpo.length !== 14) {
                return alert("CPF deve ter 11 dígitos ou CNPJ deve ter 14 dígitos.");
            }

            if (!validarDocumento(documento)) {
                return alert("Documento inválido. Verifique o CPF/CNPJ informado.");
            }

            // Preenche os dados no PDF
            document.getElementById('out_nome').innerText = document.getElementById('nome').value;
            document.getElementById('out_cpf_cnpj').innerText = documento;

            // Define o label do documento no PDF
            const tipoPessoa = document.getElementById('tipo_pessoa').value;
            if (tipoPessoa === 'cpf') {
                document.getElementById('out_documento_label').innerText = 'portador do CPF';
                document.getElementById('out_assinatura_label').innerText = 'ASSINATURA DO COMPRADOR';
            } else {
                document.getElementById('out_documento_label').innerText = 'inscrito no CNPJ';
                document.getElementById('out_assinatura_label').innerText = 'ASSINATURA DO REPRESENTANTE LEGAL';
            }

            document.getElementById('out_modelo').innerText = document.getElementById('modelo_moto').value;
            document.getElementById('out_ano').innerText = document.getElementById('ano_modelo').value;
            document.getElementById('out_placa').innerText = document.getElementById('placa').value.toUpperCase();
            document.getElementById('out_renavam').innerText = document.getElementById('renavam').value;
            document.getElementById('out_chassi').innerText = document.getElementById('chassi').value.toUpperCase();

            // Data atual
            const d = new Date();
            const meses = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            document.getElementById('out_data').innerText = `${d.getDate()} de ${meses[d.getMonth()]} de ${d.getFullYear()}`;

            // Gera PDF
            const el = document.getElementById('pdf-template');
            const canvas = await html2canvas(el, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);

            if (acao === 'salvar') {
                pdf.save(`DUT_${document.getElementById('nome').value.replace(/\s+/g, '_')}.pdf`);
            } else {
                window.open(URL.createObjectURL(pdf.output('blob')), '_blank');
            }
        }
    </script>
</body>

</html>
